<div class="container-fluid vh-100 d-flex flex-column" style="background-color: #F7F3ED;">
  <!-- Encabezado -->
  <div class="row align-items-center py-2 px-4 clientes-header">
    <div class="col-6">
      <h3 class="m-0 text-white" style="font-weight: 500;">CLIENTES</h3>
    </div>
    <div class="col-6 text-end d-flex align-items-center justify-content-end">
      <button class="btn btn-sm btn-light exit-button me-3" (click)="onSalir()">SALIR</button>
      <i class="bi bi-person-fill header-person-icon"></i>
    </div>
  </div>

  <!-- Contenido Principal -->
  <div class="flex-grow-1 d-flex justify-content-center align-items-start pt-5 pb-3">
    <div class="clientes-table-container p-4">

      <!-- Mensaje de carga -->
      <div *ngIf="isLoading" class="text-center">Cargando clientes...</div>
      <!-- Mensaje de error -->
      <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

      <!-- Tabla y Paginación (si no hay carga ni error) -->
      <div *ngIf="!isLoading && !error">
        <!-- Mensaje si no hay clientes -->
        <div *ngIf="clientes.length === 0" class="alert alert-info text-center">
          No se encontraron clientes.
        </div>

        <!-- Tabla (solo se muestra si hay clientes) -->
        <div *ngIf="clientes.length > 0" class="table-responsive">
          <table class="table clientes-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>NOMBRE, APELLIDO</th>
                <th>FECHA DE NACIMIENTO</th>
                <th>CIUDAD</th>
                <th>PROVINCIA</th>
                <th>PAIS</th>
                <th *ngIf="authService.hasPermission('editar_personas') || authService.hasPermission('eliminar_personas')">
                  ACCIONES
                </th>
              </tr>
            </thead>
            <tbody>
              <!-- El *ngFor ahora es simple. El array 'clientes' ya viene paginado del backend -->
              <tr *ngFor="let cliente of clientes">
                <td>{{ cliente.id }}</td>
                <td>{{ cliente.firstName }} {{ cliente.lastName }}</td>
                <td>{{ cliente.birthDate | date: 'dd/MM/yyyy' }}</td>
                <td>{{ cliente.city?.name }}</td>
                <td>{{ cliente.city?.province?.name }}</td>
                <td>{{ cliente.city?.province?.country?.name }}</td>
                <td *ngIf="authService.hasPermission('editar_personas') || authService.hasPermission('eliminar_personas')" class="actions-cell">
                  <button *ngIf="authService.hasPermission('eliminar_personas')" class="btn clientes-button delete-button" (click)="onEliminar(cliente.id)">ELIMINAR</button>
                  <button *ngIf="authService.hasPermission('editar_personas')" class="btn clientes-button edit-button" (click)="onEditar(cliente.id)">EDITAR</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- ***** NUESTROS CONTROLES DE PAGINACIÓN MANUAL ***** -->
        <nav *ngIf="totalPages > 1" aria-label="Page navigation">
          <ul class="pagination justify-content-center mt-3">
            <!-- Botón Anterior -->
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" href="javascript:void(0)" (click)="previousPage()">Anterior</a>
            </li>
            
            <!-- Botones de Números de Página -->
            <li class="page-item" *ngFor="let page of pages" [class.active]="page === currentPage">
              <a class="page-link" href="javascript:void(0)" (click)="goToPage(page)">{{ page }}</a>
            </li>
            
            <!-- Botón Siguiente -->
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <a class="page-link" href="javascript:void(0)" (click)="nextPage()">Siguiente</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>